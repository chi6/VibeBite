<!--index.wxml-->
<view class="container">
  <view class="main-content">
    <!-- AIçŠ¶æ€å¡ç‰‡ -->
    <view class="card ai-status-card">
      <view class="ai-header">
        <image class="ai-animation" src="/images/dog.gif" mode="aspectFit"></image>
        <view class="ai-title">
          <text class="title">{{aiStatus.name}}</text>
          <text class="subtitle">è®©ç¾é£Ÿæ¨èæ›´æ‡‚ä½ çš„å¿ƒ</text>
        </view>
      </view>
      <view class="status-tags">
        <text class="status-tag">å¿ƒæƒ…: {{aiStatus.mood}}</text>
        <text class="status-tag">æ´»è·ƒåº¦: {{aiStatus.activity}}</text>
      </view>
      <text class="ai-thought">{{aiStatus.thought}}</text>
    </view>

    <!-- é¤é¥®å–œå¥½å¡ç‰‡ -->
    <view class="card preferences-card">
      <view class="card-header">
        <text class="card-title">ä¸ªæ€§åŒ–æ¨è</text>
        <text class="card-subtitle">åŸºäºä½ çš„é¥®é£Ÿåå¥½</text>
      </view>
      
      <view class="preferences-content">
        <view class="recommendations-list">
          <view class="recommendation-category" wx:for="{{preferences.recommendations}}" wx:key="type">
            <view class="category-header">
              <view class="category-icon">{{item.icon}}</view>
              <text class="category-title">{{item.type}}</text>
              <view class="add-btn" wx:if="{{openid}}" catchtap="handleAdd" data-category-index="{{index}}">
                <text class="add-icon">â•</text>
              </view>
            </view>
            
            <view class="recommendation-items">
              <view class="recommendation-item" wx:for="{{item.items}}" wx:key="description" wx:for-item="subItem" wx:for-index="subIndex">
                <view class="item-content">
                  <view class="item-header">
                    <view class="delete-btn" wx:if="{{openid && item.items.length > 1}}" catchtap="handleDelete" data-category-index="{{index}}" data-item-index="{{subIndex}}">
                      <text class="delete-icon">ğŸ—‘ï¸</text>
                    </view>
                  </view>
                  
                  <view class="text-container {{openid ? 'editable' : ''}} {{editingItem && editingItem.categoryIndex === index && editingItem.itemIndex === subIndex ? 'editing' : ''}}" data-category-index="{{index}}" data-item-index="{{subIndex}}" catchtap="{{openid ? 'handleEdit' : ''}}">
                    <view class="rich-content">{{subItem.description}}</view>
                    <view class="edit-hint" wx:if="{{openid}}">
                      <text class="edit-icon">âœ</text>
                    </view>
                  </view>
                  
                  <block wx:if="{{editingItem && editingItem.categoryIndex === index && editingItem.itemIndex === subIndex}}">
                    <view class="edit-mask" catchtap="handleCancel"></view>
                    <view class="edit-wrapper">
                      <textarea class="edit-textarea" 
                                value="{{editingItem.originalText}}" 
                                auto-height 
                                focus 
                                maxlength="-1" 
                                show-confirm-bar="{{false}}" 
                                adjust-position="{{true}}" 
                                bindinput="handleInput" 
                                placeholder="è¯·è¾“å…¥å†…å®¹">
                      </textarea>
                      <view class="edit-actions">
                        <text class="cancel-btn" catchtap="handleCancel">å–æ¶ˆ</text>
                        <text class="save-btn" catchtap="handleSave">ä¿å­˜</text>
                      </view>
                    </view>
                  </block>
                  
                  <view class="highlight-tags" wx:if="{{subItem.highlights.length > 0}}">
                    <text class="highlight-tag" wx:for="{{subItem.highlights}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·å¯¹è¯å…¥å£ -->
    <button class="chat-btn gradient-bg" bindtap="goToAIChat">
      <view class="chat-btn-content">
        <image class="ai-icon" src="/images/ai-icon.png" mode="aspectFit"></image>
        <view class="btn-text">
          <text class="btn-title">ä¸AIåŠ©æ‰‹å¯¹è¯</text>
          <text class="btn-desc">è®©AIä¸ºæ‚¨æ¨èç¾é£Ÿ</text>
        </view>
      </view>
    </button>
  </view>
</view>
