<!--index.wxml-->
<view class="container">
  <view class="notebook-container">
    <!-- AI对话入口 -->
    <view class="notebook-section chat-section">
      <view class="paper-header">
        <image class="ai-avatar" src="/images/ai-icon.png" mode="aspectFit"></image>
        <view class="chat-info">
          <text class="chat-title">与AI助手对话</text>
          <text class="chat-subtitle">让AI为您推荐美食</text>
        </view>
        <button class="chat-btn" bindtap="goToAIChat">
          <text class="btn-icon">💭</text>
        </button>
      </view>
    </view>

    <!-- 个性化推荐笔记本 -->
    <view class="notebook-section main-section">
      <view class="paper-title">
        <text class="title-text">个性化推荐</text>
        <text class="date-text">基于你的饮食偏好</text>
      </view>

      <!-- 便签式标签页 -->
      <view class="tabs-container">
        <view class="tab-list">
          <view class="tab {{currentTab === index ? 'active' : ''}}"
                wx:for="{{preferences.recommendations}}"
                wx:key="type"
                bindtap="switchTab"
                data-index="{{index}}">
            <text class="tab-icon">{{item.icon}}</text>
            <text class="tab-text">{{item.type}}</text>
          </view>
        </view>

        <!-- 便签内容区域 -->
        <view class="notes-container">
          <view class="note-list {{currentTab === index ? 'show' : ''}}"
                wx:for="{{preferences.recommendations}}"
                wx:key="type">
            <view class="note-item {{openid ? 'editable' : ''}}"
                  wx:for="{{item.items}}"
                  wx:for-item="subItem"
                  wx:for-index="subIndex"
                  wx:key="description">
              
              <view class="note-content">
                <view class="note-text">{{subItem.description}}</view>
                
                <!-- 编辑和删除按钮 -->
                <view class="note-actions" wx:if="{{openid}}">
                  <view class="action-btn edit-btn"
                        catchtap="handleEdit"
                        data-category-index="{{index}}"
                        data-item-index="{{subIndex}}">
                    <text class="action-icon">✎</text>
                  </view>
                  <view class="action-btn delete-btn"
                        wx:if="{{item.items.length > 1}}"
                        catchtap="handleDelete"
                        data-category-index="{{index}}"
                        data-item-index="{{subIndex}}">
                    <text class="action-icon">🗑️</text>
                  </view>
                </view>

                <!-- 标签 -->
                <view class="note-tags" wx:if="{{subItem.highlights.length > 0}}">
                  <text class="tag" wx:for="{{subItem.highlights}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
                </view>
              </view>
            </view>

            <!-- 添加按钮 -->
            <view class="add-note" wx:if="{{openid}}" bindtap="handleAdd" data-category-index="{{index}}">
              <text class="add-icon">+</text>
              <text class="add-text">添加新项目</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
