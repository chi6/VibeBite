<view class="container">
  <!-- AI互动区域 - 使用更现代的设计 -->
  <view class="ai-interaction">
    <view class="ai-character-wrapper">
      <view class="ai-character ai-left">
        <image class="ai-animation" src="/images/ai-left.gif" mode="aspectFit"></image>
      </view>
      <view class="ai-character ai-right">
        <image class="ai-animation" src="/images/ai-right.gif" mode="aspectFit"></image>
      </view>
    </view>
    <view class="ai-status">
      <text class="ai-status-text">AI正在分析...</text>
    </view>
  </view>

  <!-- 添加分享按钮 -->
  <view class="action-buttons">
    <button class="share-btn" open-type="share">
      <image class="share-icon" src="/images/share.png" mode="aspectFit"></image>
      <text>分享对话</text>
    </button>
  </view>

  <!-- 聊天内容区域 - 优化消息展示 -->
  <view class="chat-container">
    <scroll-view 
      scroll-y="true" 
      class="chat-list" 
      scroll-into-view="{{scrollToMessage}}"
      enhanced="true"
      show-scrollbar="false">
      <block wx:for="{{messages}}" wx:key="id">
        <view id="msg-{{item.id}}" class="message {{item.type}}">
          <view class="avatar">
            <image src="{{item.type === 'user' ? '/images/logo.png' : '/images/headphoto.jpeg'}}" mode="aspectFit"></image>
          </view>
          <view class="content-wrapper">
            <view class="content">{{item.content}}</view>
            <view class="message-time">{{item.time}}</view>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- 在聊天容器下方添加一个触发按钮 -->
  <view class="trigger-recommendations" bindtap="toggleRecommendations">
    <image src="/images/logo.png" mode="aspectFit"></image>
  </view>

  <!-- 添加遮罩层 -->
  <view class="recommendations-mask {{showRecommendations ? 'show' : ''}}" bindtap="toggleRecommendations"></view>

  <!-- 浮动推荐窗口 -->
  <view class="floating-recommendations {{showRecommendations ? 'show' : ''}}">
    <view class="recommendations-header">
      <text class="recommendations-title">AI智能推荐</text>
      <view class="close-btn" bindtap="toggleRecommendations">×</view>
    </view>
    
    <!-- 标签页切换 -->
    <view class="tab-header">
      <view class="tab-item {{currentTab === 'restaurants' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="restaurants">餐厅推荐</view>
      <view class="tab-item {{currentTab === 'images' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="images">美食图片</view>
      <view class="tab-item {{currentTab === 'questions' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="questions">相关问题</view>
    </view>

    <scroll-view scroll-y="true" class="recommendations-content">
      <!-- 餐厅推荐列表 -->
      <view class="recommendation-list" hidden="{{currentTab !== 'restaurants'}}">
        <view class="recommendation-card" 
              wx:for="{{recommendations}}" 
              wx:key="position"
              bindtap="handleRecommendationTap"
              data-type="restaurant"
              data-link="{{item.link}}">
          <view class="card-header">
            <text class="restaurant-name">{{item.title}}</text>
            <text class="distance">{{item.distance}}</text>
          </view>
          <text class="description">{{item.description}}</text>
          
          <!-- 添加快照图片展示 -->
          <scroll-view class="snapshot-images" scroll-x="true" wx:if="{{item.snapshotImages.length > 0}}">
            <view class="snapshot-container">
              <image class="snapshot" 
                     wx:for="{{item.snapshotImages}}" 
                     wx:key="*this" 
                     wx:for-item="imageUrl"
                     src="{{imageUrl}}" 
                     mode="aspectFill"></image>
            </view>
          </scroll-view>

          <view class="card-footer">
            <text class="location">{{item.location}}</text>
            <text class="date">{{item.formattedDate}}</text>
          </view>
        </view>
      </view>

      <!-- 美食图片展示 -->
      <view class="image-grid" hidden="{{currentTab !== 'images'}}">
        <view class="image-item" 
              wx:for="{{images}}" 
              wx:key="imageUrl"
              bindtap="handleRecommendationTap"
              data-type="image"
              data-link="{{item.imageUrl}}">
          <image src="{{item.imageUrl}}" mode="aspectFill"></image>
          <text class="image-title">{{item.title}}</text>
        </view>
      </view>

      <!-- 相关问题列表 -->
      <view class="question-list" hidden="{{currentTab !== 'questions'}}">
        <view class="question-item" 
              wx:for="{{relatedQuestions}}" 
              wx:key="question"
              bindtap="handleRecommendationTap"
              data-type="question"
              data-question="{{item.question}}">
          <text class="question">{{item.question}}</text>
          <text class="answer">{{item.answer}}</text>
        </view>
      </view>
    </scroll-view>

    <!-- 相关搜索词 -->
    <view class="related-searches">
      <scroll-view scroll-x="true" class="search-tags">
        <text class="search-tag" 
              wx:for="{{relatedSearches}}" 
              wx:key="*this"
              bindtap="handleSearchTap"
              data-term="{{item}}">{{item}}</text>
      </scroll-view>
    </view>
  </view>

  <!-- 输入区域 - 现代化设计 -->
  <view class="input-container">
    <view class="input-wrapper">
      <input 
        class="chat-input" 
        type="text" 
        value="{{inputMessage}}" 
        bindinput="onInputChange" 
        placeholder="说点什么吧..."
      />
      <view class="input-actions">
        <view class="voice-btn" bindtap="startVoiceInput">
          <image src="/images/logo.png" mode="aspectFit"></image>
        </view>
        <button class="send-btn" bindtap="sendMessage">发送</button>
      </view>
    </view>
  </view>
</view>
