<view class="container">
  <!-- AI互动区域 - 使用更现代的设计 -->
  <view class="ai-interaction">
    <view class="ai-character-wrapper">
      <view class="ai-character ai-left">
        <image class="ai-animation" src="/images/ai-left.gif" mode="aspectFit"></image>
      </view>
      <view class="ai-character ai-right">
        <image class="ai-animation" src="/images/ai-right.gif" mode="aspectFit"></image>
      </view>
    </view>
    <view class="ai-status">
      <text class="ai-status-text">AI正在分析...</text>
    </view>
  </view>

  <!-- 添加分享按钮 -->
  <view class="action-buttons">
    <button class="share-btn" open-type="share">
      <image class="share-icon" src="/images/share.png" mode="aspectFit"></image>
      <text>分享对话</text>
    </button>
  </view>

  <!-- 聊天内容区域 - 优化消息展示 -->
  <view class="chat-container">
    <scroll-view 
      scroll-y="true" 
      class="chat-list" 
      scroll-into-view="{{scrollToMessage}}"
      enhanced="true"
      show-scrollbar="false">
      <block wx:for="{{messages}}" wx:key="id">
        <view id="msg-{{item.id}}" class="message {{item.type}}">
          <view class="avatar">
            <image src="{{item.type === 'user' ? '/images/logo.png' : '/images/headphoto.jpeg'}}" mode="aspectFit"></image>
          </view>
          <view class="content-wrapper">
            <view class="content">{{item.content}}</view>
            <view class="message-time">{{item.time}}</view>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- 在聊天容器下方添加一个触发按钮 -->
  <view class="trigger-recommendations" bindtap="toggleRecommendations">
    <image src="/images/logo.png" mode="aspectFit"></image>
  </view>

  <!-- 添加遮罩层 -->
  <view class="recommendations-mask {{showRecommendations ? 'show' : ''}}" bindtap="toggleRecommendations"></view>

  <!-- 浮动推荐窗口 -->
  <view class="floating-recommendations {{showRecommendations ? 'show' : ''}}">
    <view class="recommendations-header">
      <text class="recommendations-title">AI智能推荐</text>
      <view class="close-btn" bindtap="toggleRecommendations">×</view>
    </view>

    <!-- 意图标签显示 -->
    <view class="intents-container" wx:if="{{intents.length > 0}}">
      <view class="intent-tags">
        <text class="intent-tag" wx:for="{{intents}}" wx:key="*this">{{item}}</text>
      </view>
    </view>

    <!-- 计划内容显示 -->
    <view class="plan-section" wx:if="{{organizedPlan}}">
      <view class="plan-title">AI规划建议</view>
      <scroll-view 
        class="organized-plan" 
        scroll-y="true"
        enhanced="true"
        show-scrollbar="true">
        <view class="plan-block" wx:for="{{organizedPlan}}" wx:key="title">
          <view class="block-title">{{item.title}}</view>
          <view 
            wx:for="{{item.details}}" 
            wx:key="content" 
            wx:for-item="detail"
            class="block-detail {{detail.type === 'detail' ? 'with-dot' : ''}}">
            <text class="detail-icon">{{detail.type === 'detail' ? '🔸' : '📝'}}</text>
            <view class="detail-content">
              <text class="detail-text">{{detail.content}}</text>
              
              <!-- 添加快照图片展示 -->
              <view class="detail-snapshots" wx:if="{{detail.snapshots && detail.snapshots.length > 0}}">
                <scroll-view scroll-x="true" class="snapshots-scroll">
                  <view class="snapshots-container">
                    <view 
                      class="snapshot-item" 
                      wx:for="{{detail.snapshots}}" 
                      wx:key="url" 
                      wx:for-item="snapshot"
                      bindtap="handleSnapshotTap"
                      data-url="{{snapshot.url}}"
                      data-images="{{detail.snapshots}}">
                      <image 
                        class="snapshot-thumb" 
                        src="{{snapshot.image}}" 
                        mode="aspectFill"
                        lazy-load="true"
                      ></image>
                      <text class="snapshot-title">{{snapshot.title}}</text>
                    </view>
                  </view>
                </scroll-view>
              </view>
              
              <!-- 链接显示 -->
              <view class="detail-links" wx:if="{{detail.links && detail.links.length > 0}}">
                <view 
                  class="link-item" 
                  wx:for="{{detail.links}}" 
                  wx:key="url" 
                  wx:for-item="link"
                  bindtap="handleLinkTap"
                  data-url="{{link.url}}">
                  <text class="link-icon">🔗</text>
                  <text class="link-text">{{link.title || '查看详情'}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 餐厅推荐列表 -->
    <scroll-view scroll-y="true" class="recommendations-content">
      <!-- 按日期分组显示推荐 -->
      <block wx:for="{{groupedRecommendations}}" wx:key="date" wx:for-item="group">
        <view class="recommendation-date">
          <text class="date-text">{{group.date}}</text>
          <text class="recommendation-count">({{group.items.length}}条推荐)</text>
        </view>
        
        <view class="recommendation-group">
          <view class="link-card" 
                wx:for="{{group.items}}" 
                wx:key="uniqueId"
                bindtap="handleLinkTap"
                data-url="{{item.link}}">
            <!-- 添加网页快照显示 -->
            <view class="snapshot-preview" wx:if="{{item.snapshot}}">
              <image 
                class="snapshot-image" 
                src="{{item.snapshot}}" 
                mode="aspectFill"
                lazy-load="true"
              ></image>
            </view>
            <view class="link-content">
              <text class="link-title">{{item.title}}</text>
              <text class="link-description" wx:if="{{item.description}}">{{item.description}}</text>
              <text class="link-type" wx:if="{{item.type}}">{{item.type}}</text>
              <text class="link-domain" wx:if="{{item.domain}}">{{item.domain}}</text>
            </view>
            <text class="link-arrow">→</text>
          </view>
        </view>
      </block>
    </scroll-view>

    <!-- 相关搜索词 -->
    <view class="related-searches">
      <scroll-view scroll-x="true" class="search-tags">
        <text class="search-tag" 
              wx:for="{{relatedSearches}}" 
              wx:key="*this"
              bindtap="handleSearchTap"
              data-term="{{item}}">{{item}}</text>
      </scroll-view>
    </view>

    <!-- 添加空状态提示 -->
    <view class="empty-state" wx:if="{{!recommendations.length}}">
      <view class="empty-state-icon">🤔</view>
      <view class="empty-state-text">暂时没有推荐内容</view>
      <view class="empty-state-text">试试发送一条消息吧</view>
    </view>

    <!-- 添加滚动到顶部按钮 -->
    <view class="scroll-to-top {{showScrollTop ? 'show' : ''}}" bindtap="scrollToTop"></view>
  </view>

  <!-- 输入区域 - 现代化设计 -->
  <view class="input-container">
    <view class="input-wrapper">
      <input 
        class="chat-input" 
        type="text" 
        value="{{inputValue}}" 
        bindinput="onInputChange" 
        placeholder="说点什么吧..."
      />
      <view class="input-actions">
        <view class="voice-btn" bindtap="startVoiceInput">
          <image src="/images/logo.png" mode="aspectFit"></image>
        </view>
        <button class="send-btn" bindtap="sendMessage">发送</button>
      </view>
    </view>
  </view>
</view>
