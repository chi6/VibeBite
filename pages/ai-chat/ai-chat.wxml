<view class="container">
  <!-- AIäº’åŠ¨åŒºåŸŸ - ä½¿ç”¨æ›´ç°ä»£çš„è®¾è®¡ -->
  <view class="ai-interaction">
    <view class="ai-character-wrapper">
      <view class="ai-character ai-left">
        <image class="ai-animation" src="/images/ai-left.gif" mode="aspectFit"></image>
      </view>
      <view class="ai-character ai-right">
        <image class="ai-animation" src="/images/ai-right.gif" mode="aspectFit"></image>
      </view>
    </view>
    <view class="ai-status">
      <text class="ai-status-text">AIæ­£åœ¨åˆ†æ...</text>
    </view>
  </view>

  <!-- æ·»åŠ åˆ†äº«æŒ‰é’® -->
  <!-- <view class="action-buttons">
    <button class="share-btn" open-type="share">
      <image class="share-icon" src="/images/share.png" mode="aspectFit"></image>
      <text>åˆ†äº«å¯¹è¯</text>
    </button>
  </view> -->

  <!-- èŠå¤©å†…å®¹åŒºåŸŸ - ä¼˜åŒ–æ¶ˆæ¯å±•ç¤º -->
  <view class="chat-container">
    <scroll-view 
      scroll-y="true" 
      class="chat-list" 
      scroll-into-view="{{scrollToMessage}}"
      enhanced="true"
      show-scrollbar="false">
      <block wx:for="{{messages}}" wx:key="id">
        <view id="msg-{{item.id}}" class="message {{item.type}}">
          <view class="avatar">
            <image src="{{item.type === 'user' ? '/images/logo.png' : '/images/logo.png'}}" mode="aspectFit"></image>
          </view>
          <view class="content-wrapper">
            <view class="content">{{item.content}}</view>
            <view class="message-time">{{item.time}}</view>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- ä¿®æ”¹æ¨èè§¦å‘æŒ‰é’® -->
  <view class="trigger-recommendations {{showRecommendations ? 'active' : ''}}" bindtap="toggleRecommendations">
    <view class="trigger-inner">
        <text class="trigger-icon">ğŸ¯</text>
        <text class="trigger-text">æ™ºèƒ½æ¨è</text>
    </view>
  </view>

  <!-- æ·»åŠ é®ç½©å±‚ -->
  <view class="recommendations-mask {{showRecommendations ? 'show' : ''}}" bindtap="toggleRecommendations"></view>

  <!-- æµ®åŠ¨æ¨èçª—å£ -->
  <view class="floating-recommendations {{showRecommendations ? 'show' : ''}}">
    <view class="recommendations-header">
      <text class="recommendations-title">AIæ™ºèƒ½æ¨è</text>
      <view class="close-btn" bindtap="toggleRecommendations">Ã—</view>
    </view>

    <!-- æ„å›¾æ ‡ç­¾æ˜¾ç¤º -->
    <view class="intents-container" wx:if="{{intents.length > 0}}">
      <view class="intent-tags">
        <text class="intent-tag" wx:for="{{intents}}" wx:key="*this">{{item}}</text>
      </view>
    </view>

    <!-- åœ¨æµ®åŠ¨çª—å£ä¸­åˆå¹¶ plan-section å’Œ recommendations-content -->
    <scroll-view scroll-y="true" class="recommendations-content">

      <!-- è®¡åˆ’å†…å®¹æ˜¾ç¤º -->
      <view class="plan-section" wx:if="{{organizedPlan}}">
        <view class="section-title">AIè§„åˆ’å»ºè®®</view>
        <view class="plan-blocks">
          <view class="plan-block" wx:for="{{organizedPlan}}" wx:key="title">
            <view class="block-title">
              <text class="title-text">{{item.title}}</text>
            </view>
            
            <view 
              wx:for="{{item.details}}" 
              wx:key="content" 
              wx:for-item="detail"
              class="block-detail {{detail.type === 'detail' ? 'with-dot' : ''}}">
              <text class="detail-icon">{{detail.type === 'detail' ? 'ğŸ”¸' : 'ğŸ“'}}</text>
              <view class="detail-content">
                <view class="detail-main">
                  <!-- æ˜¾ç¤ºé«˜äº®å…³é”®è¯ -->
                  <view class="detail-highlights" wx:if="{{detail.highlights.length > 0}}">
                    <text class="highlight-tag" 
                          wx:for="{{detail.highlights}}" 
                          wx:key="*this" 
                          wx:for-item="highlight">{{highlight}}</text>
                  </view>
                  <text class="detail-text">{{detail.content}}</text>
                  
                  <!-- æ˜¾ç¤ºåœ°å€ä¿¡æ¯ -->
                  <view class="detail-address" wx:if="{{detail.address}}">
                    <text class="address-icon">ğŸ“</text>
                    <text class="address-text">{{detail.address}}</text>
                  </view>
                  
                  <!-- æ˜¾ç¤ºç‰¹è‰²ä¿¡æ¯ -->
                  <view class="detail-feature" wx:if="{{detail.feature}}">
                    <text class="feature-icon">âœ¨</text>
                    <text class="feature-text">{{detail.feature}}</text>
                  </view>
                  
                  <!-- æ˜¾ç¤ºå›¾ç‰‡æ•°é‡ä¿¡æ¯ -->
                  <view class="detail-images" wx:if="{{detail.imageCount}}">
                    <text class="images-icon">ğŸ–¼ï¸</text>
                    <text class="images-text">{{detail.imageCount}}å¼ å®æ‹å›¾ç‰‡</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      <!-- åˆ†å‰²çº¿ -->
      <view class="section-divider" wx:if="{{organizedPlan && groupedRecommendations.length > 0}}"></view>
 
      <!-- æ¨èåˆ—è¡¨ -->
      <view class="recommendations-list">
        <view class="section-title" wx:if="{{groupedRecommendations.length > 0}}">æ¨èåˆ—è¡¨</view>
        <block wx:for="{{groupedRecommendations}}" wx:key="date" wx:for-item="group">
          <view class="recommendation-date">
            <text class="date-text">{{group.date}}</text>
            <text class="recommendation-count">({{group.items.length}}æ¡æ¨è)</text>
          </view>
          
          <view class="recommendation-group">
            <view class="link-card" 
                  wx:for="{{group.items}}" 
                  wx:key="uniqueId"
                  bindtap="handleLinkTap"
                  data-url="{{item.link}}"
                  data-snapshot="{{item.snapshot}}">
              <view class="snapshot-preview" wx:if="{{item.snapshot}}">
                <image 
                  class="snapshot-image" 
                  src="{{item.snapshot}}" 
                  mode="aspectFill"
                  lazy-load="true"
                  binderror="handleImageError"
                  data-recommend-index="{{index}}"
                ></image>
              </view>
              <view class="link-content">
                <text class="link-title">{{item.title || 'æ¨èå†…å®¹'}}</text>
                <text class="link-description" wx:if="{{item.description}}">{{item.description}}</text>
                <text class="link-type" wx:if="{{item.type}}">{{item.type}}</text>
                <text class="link-domain" wx:if="{{item.domain}}">{{item.domain}}</text>
              </view>
              <text class="link-arrow">â†’</text>
            </view>
          </view>
        </block>
      </view>

    </scroll-view>

    <!-- ç›¸å…³æœç´¢è¯ -->
    <view class="related-searches">
      <scroll-view scroll-x="true" class="search-tags">
        <text class="search-tag" 
              wx:for="{{relatedSearches}}" 
              wx:key="*this"
              bindtap="handleSearchTap"
              data-term="{{item}}">{{item}}</text>
      </scroll-view>
    </view>

    <!-- æ·»åŠ ç©ºçŠ¶æ€æç¤º -->
    <view class="empty-state" wx:if="{{!recommendations.length}}">
      <view class="empty-state-icon">ğŸ¤”</view>
      <view class="empty-state-text">æš‚æ—¶æ²¡æœ‰æ¨èå†…å®¹</view>
      <view class="empty-state-text">è¯•è¯•å‘é€ä¸€æ¡æ¶ˆæ¯å§</view>
    </view>

    <!-- æ·»åŠ æ»šåŠ¨åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <view class="scroll-to-top {{showScrollTop ? 'show' : ''}}" bindtap="scrollToTop"></view>
  </view>

  <!-- è¾“å…¥åŒºåŸŸ - ç°ä»£åŒ–è®¾è®¡ -->
  <view class="input-container">
    <view class="input-wrapper">
      <input 
        class="chat-input" 
        type="text" 
        value="{{inputValue}}" 
        bindinput="onInputChange" 
        placeholder="è¯´ç‚¹ä»€ä¹ˆå§..."
      />
      <view class="input-actions">
        <view class="voice-btn" bindtap="startVoiceInput">
          <image src="/images/logo.png" mode="aspectFit"></image>
        </view>
        <button class="send-btn" bindtap="sendMessage">å‘é€</button>
      </view>
    </view>
  </view>

  <!-- ä¿®æ”¹æµ®åŠ¨çª—å£è§¦å‘æŒ‰é’® -->
  <view class="trigger-floating" bindtap="toggleFloatingWindow">
    <view class="trigger-inner">
      <text class="trigger-icon">ğŸ’¡</text>
      <text class="trigger-text">æ„è§åé¦ˆ</text>
    </view>
  </view>

  <!-- æ·»åŠ æ–°çš„æµ®åŠ¨çª—å£ -->
  <view class="floating-mask {{showFloatingWindow ? 'show' : ''}}" bindtap="toggleFloatingWindow"></view>

  <!-- æ„è§åé¦ˆæµ®åŠ¨çª—å£ -->
  <view class="floating-feedback {{showFloatingWindow ? 'show' : ''}}">
    <view class="feedback-header">
      <text class="feedback-title">æ„è§åé¦ˆ</text>
      <view class="close-btn" bindtap="toggleFloatingWindow">Ã—</view>
    </view>
    
    <view class="feedback-content">
      <textarea 
        class="feedback-input" 
        placeholder="è¯·è¾“å…¥æ‚¨çš„æ„è§æˆ–å»ºè®®..." 
        value="{{feedbackContent}}"
        bindinput="onFeedbackInput"
      ></textarea>
      
      <view class="feedback-contact">
        <input 
          class="contact-input" 
          type="text" 
          placeholder="è”ç³»æ–¹å¼ï¼ˆé€‰å¡«ï¼‰" 
          value="{{contactInfo}}"
          bindinput="onContactInput"
        />
      </view>
      
      <button class="submit-feedback" bindtap="submitFeedback">æäº¤åé¦ˆ</button>
    </view>
  </view>

</view>
